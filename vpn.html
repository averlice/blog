<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <style type="text/css">.lst-kix_s57gstd1nui8-1>li:before{content:"\0025cb   "}.lst-kix_s57gstd1nui8-2>li:before{content:"\0025a0   "}.lst-kix_s57gstd1nui8-0>li:before{content:"\0025cf   "}.lst-kix_s57gstd1nui8-3>li:before{content:"\0025cf   "}.lst-kix_s57gstd1nui8-4>li:before{content:"\0025cb   "}ul.lst-kix_p0owf8905ngy-0{list-style-type:none}ul.lst-kix_p0owf8905ngy-1{list-style-type:none}ul.lst-kix_p0owf8905ngy-2{list-style-type:none}.lst-kix_s57gstd1nui8-7>li:before{content:"\0025cb   "}.lst-kix_s57gstd1nui8-8>li:before{content:"\0025a0   "}ul.lst-kix_p0owf8905ngy-3{list-style-type:none}ul.lst-kix_p0owf8905ngy-4{list-style-type:none}ul.lst-kix_j1xhtargmr9t-8{list-style-type:none}.lst-kix_s57gstd1nui8-5>li:before{content:"\0025a0   "}.lst-kix_s57gstd1nui8-6>li:before{content:"\0025cf   "}.lst-kix_6tkr1rwl23sc-0>li:before{content:"\0025cf   "}.lst-kix_p0owf8905ngy-1>li:before{content:"\0025cb   "}.lst-kix_j1xhtargmr9t-0>li:before{content:"\0025cf   "}.lst-kix_p0owf8905ngy-0>li:before{content:"\0025cf   "}.lst-kix_p0owf8905ngy-4>li:before{content:"\0025cb   "}.lst-kix_p0owf8905ngy-5>li:before{content:"\0025a0   "}.lst-kix_p0owf8905ngy-6>li:before{content:"\0025cf   "}.lst-kix_j1xhtargmr9t-5>li:before{content:"\0025a0   "}ul.lst-kix_s57gstd1nui8-7{list-style-type:none}ul.lst-kix_s57gstd1nui8-8{list-style-type:none}ul.lst-kix_s57gstd1nui8-5{list-style-type:none}.lst-kix_j1xhtargmr9t-3>li:before{content:"\0025cf   "}ul.lst-kix_s57gstd1nui8-6{list-style-type:none}ul.lst-kix_s57gstd1nui8-3{list-style-type:none}.lst-kix_j1xhtargmr9t-4>li:before{content:"\0025cb   "}ul.lst-kix_s57gstd1nui8-4{list-style-type:none}ul.lst-kix_s57gstd1nui8-1{list-style-type:none}.lst-kix_j1xhtargmr9t-1>li:before{content:"\0025cb   "}ul.lst-kix_s57gstd1nui8-2{list-style-type:none}.lst-kix_p0owf8905ngy-3>li:before{content:"\0025cf   "}ul.lst-kix_s57gstd1nui8-0{list-style-type:none}.lst-kix_j1xhtargmr9t-2>li:before{content:"\0025a0   "}ul.lst-kix_p0owf8905ngy-2>li:before{content:"\0025a0   "}.lst-kix_j1xhtargmr9t-6>li:before{content:"\0025cf   "}ul.lst-kix_p0owf8905ngy-7>li:before{content:"\0025cb   "}.lst-kix_j1xhtargmr9t-7>li:before{content:"\0025cb   "}.lst-kix_j1xhtargmr9t-8>li:before{content:"\0025a0   "}.lst-kix_p0owf8905ngy-8>li:before{content:"\0025a0   "}.lst-kix_6tkr1rwl23sc-3>li:before{content:"\0025cf   "}.lst-kix_6tkr1rwl23sc-1>li:before{content:"\0025cb   "}.lst-kix_6tkr1rwl23sc-2>li:before{content:"\0025a0   "}ul.lst-kix_6tkr1rwl23sc-0{list-style-type:none}ul.lst-kix_6tkr1rwl23sc-4{list-style-type:none}ul.lst-kix_6tkr1rwl23sc-3{list-style-type:none}ul.lst-kix_6tkr1rwl23sc-2{list-style-type:none}ul.lst-kix_6tkr1rwl23sc-1{list-style-type:none}ul.lst-kix_p0owf8905ngy-5{list-style-type:none}ul.lst-kix_j1xhtargmr9t-7{list-style-type:none}ul.lst-kix_p0owf8905ngy-6{list-style-type:none}.lst-kix_6tkr1rwl23sc-4>li:before{content:"\0025cb   "}ul.lst-kix_j1xhtargmr9t-6{list-style-type:none}ul.lst-kix_p0owf8905ngy-7{list-style-type:none}ul.lst-kix_j1xhtargmr9t-5{list-style-type:none}ul.lst-kix_p0owf8905ngy-8{list-style-type:none}ul.lst-kix_j1xhtargmr9t-4{list-style-type:none}ul.lst-kix_j1xhtargmr9t-3{list-style-type:none}.lst-kix_6tkr1rwl23sc-5>li:before{content:"\0025a0   "}.lst-kix_6tkr1rwl23sc-6>li:before{content:"\0025cf   "}ul.lst-kix_j1xhtargmr9t-2{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix_j1xhtargmr9t-1{list-style-type:none}ul.lst-kix_j1xhtargmr9t-0{list-style-type:none}</style>
  </head>
  <body class="c10 doc-content">
    <p class="c12 title" id="h.rv0sg0z4h23u">
      <span class="c11">idea for application</span>
    </p>
    <h1 class="c0" id="h.o1ap7qconsas">
      <span class="c9">Name and Description of application</span>
    </h1>
    <p class="c1">
      <span class="c2">Name: clientguard</span>
    </p>
    <p class="c1">
      <span class="c2">Description: this application is a VPN application that would ideally be open source.</span>
    </p>
    <p class="c1">
      <span class="c2">The idea &nbsp;is to make a hardware-enforced, no logging VPN protocol that would secure devices VPN traffic from even the VPN company itself.</span>
    </p>
    <h3 class="c7" id="h.q5kooetnuauq">
      <span class="c13">How would it work?</span>
    </h3>
    <p class="c1">
      <span>If you are in IT, you will know most VPN providers use server side key generation. This is because VPNs, as stated by </span>
      <span class="c3">
        <a class="c5" href="https://www.paloaltonetworks.com/cyberpedia/history-of-vpn" target="_blank">palo alto networks</a>
      </span>
      <span class="c2">, were used to securely connect to private networks.</span>
    </p>
    <p class="c1">
      <span>These are the norms, such as </span>
      <span class="c3">
        <a class="c5" href="https://openvpn.com" target="_blank">openvpn</a>
      </span>
      <span>, </span>
      <span>ipsec</span>
      <span>, and even </span>
      <span class="c3">
        <a class="c5" href="https://www.wireguard.com/" target="_blank">wireguard</a>
      </span>
      <span class="c2">.</span>
    </p>
    <h1 class="c0" id="h.xlqr8fy5hkmr">
      <span class="c9">The problem</span>
    </h1>
    <p class="c1">
      <span class="c2">Server side key generation allows for administrators of the VPN provider to read logs of traffic and decrypt traffic.</span>
    </p>
    <p class="c1">
      <span class="c2">The idea is to have no logging by making the key generation client side, meaning all the key generation happens locally, not on the server.</span>
    </p>
    <h1 class="c0" id="h.u5si1zbu70a">
      <span class="c9">How would the key generation &nbsp;work?</span>
    </h1>
    <p class="c1">
      <span class="c2">The client would work in 2 ways</span>
    </p>
    <p class="c1">
      <span>The first way is using the trusted execution environment or secure enclave of the computer. Examples include: on android, </span>
      <span class="c3">
        <a class="c5" href="https://source.android.com/docs/security/features/trusty" target="_blank">trusty (android open source project)</a>
      </span>
      <span>, or on IOS, &nbsp;or on IOS, it would use the </span>
      <span class="c3">
        <a class="c5" href="https://support.apple.com/guide/security/secure-enclave-sec59b0b31ff/web" target="_blank">apple secure enclave</a>
      </span>
    </p>
    <p class="c1">
      <span>On windows, depending on a processor type, you can either have the </span>
      <span class="c3">
        <a class="c5" href="https://www.intel.com/content/www/us/en/developer/tools/trust-domain-extensions/overview.html" target="_blank">intel TDX</a>
      </span>
      <span class="c2">&nbsp;or AMD TEE</span>
    </p>
    <p class="c1">
      <span class="c2">The &nbsp;only reliable tee however, is trusty due to it having an open source capability.</span>
    </p>
    <p class="c1">
      <span class="c2">The problem with blackboxes, such as TdX, apples secure enclave, etc, is that you do not necessarily know what code is on it, and &nbsp;the problem with that is if a vulnerability has been executed and it even partially relies on is remote code execution, this means your TEE has been tanked!</span>
    </p>
    <p class="c1">
      <span class="c2">The solution to this is to store keys on a hardware security module that is open source.</span>
    </p>
    <p class="c1">
      <span>An example of this is the &nbsp;</span>
      <span class="c3">
        <a class="c5" href="https://shop.nitrokey.com/shop/nkhs2-nitrokey-hsm-2-7" target="_blank">nitrokey HSM</a>
      </span>
      <span class="c2">&nbsp; which securely stores keys, and can be exported anywhere.</span>
    </p>
    <p class="c1">
      <span>As an added benefit is the fact that if PKCS#11 libraries are programmed into the keys rust APIs, you will be able to conduct </span>
      <span class="c3">
        <a class="c5" href="https://www.vmware.com/topics/perfect-forward-secrecy" target="_blank">perfect forward secrecy</a>
      </span>
      <span class="c2">&nbsp;which will allow secure key deletion and rotation, meaning that a key compromise will not compromise the entire session.</span>
    </p>
    <h1 class="c0" id="h.9lvfryhxiwtc">
      <span class="c9">Cryptography</span>
    </h1>
    <p class="c1">
      <span>Since we will theoretically use asymmetrical encryption, we should use algorithms such as </span>
      <span class="c3">
        <a class="c5" href="https://csrc.nist.gov/csrc/media/Events/2022/fourth-pqc-standardization-conference/documents/papers/a-flexible-shared-hardware-accelerator-pqc2022.pdf" target="_blank">kyber and dilithium</a>
      </span>
      <span class="c2">&nbsp;for post quantum cryptography algorithms.</span>
    </p>
    <p class="c1">
      <span class="c2">This will allow for post quantum encryption.</span>
    </p>
    <p class="c1">
      <span>Note: if you want to build a national security system, this algorithm is part of the </span>
      <span class="c3">
        <a class="c5" href="https://media.defense.gov/2025/May/30/2003728741/-1/-1/0/CSA_CNSA_2.0_ALGORITHMS.PDF" target="_blank">commercial national security algorithm sweet 2.0</a>
      </span>
    </p>
    <p class="c1">
      <span class="c2">This key would be used to authenticate &nbsp;the session and secure the connection itself.</span>
    </p>
    <p class="c1">
      <span class="c3">
        <a class="c5" href="https://csrc.nist.gov/pubs/fips/203/final" target="_blank">ML-KEM</a>
      </span>
      <span class="c2">&nbsp;would be used to encrypt the traffic itself during the connection.</span>
    </p>
    <p class="c1">
      <span class="c2">It can both encapsulate and exchange keys, which both allows for confidentiality during receiving of the key, and protection of the traffic.</span>
    </p>
    <p class="c1">
      <span class="c2">In an ephemeral key setup, ML-KEM will be able to do perfect forward secrecy.</span>
    </p>
    <h1 class="c0" id="h.cbz8q4sa1zk1">
      <span class="c9">Rules of the application:</span>
    </h1>
    <ul class="c6 lst-kix_j1xhtargmr9t-0 start">
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Keys may not leave the secure enclave, whether it is androids TEE&lt; or a physical hardware key.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">The user must present their key (if hardware key based) before the VPN connects, or else it will not establish a connection.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If no key is detected, the connection drops.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">The minute the application can no longer connect with the key post-session while the VPN is running, the connection must be dropped, as it is assumed to be a compromise.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If the session cannot be authenticated, or there is a false signature/a signature the client did not generate onto the key, the connection must not go through, and a warning will be displayed.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Client side key generation must be local and offline.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If the signature has been erased from the key, a new one must be generated by the user. Note: keys should be ephemeral, so keys should erase after a period of time (EG: 10minutes, 15minutes).</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">The client should assume both the VPN server and the user as hostile &nbsp;and or stupid, and make sure it will not be easy to transport keys from the secure enclave to memmery/ram.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Users should have the ability to do key verification to ensure the key the client is generating is a key that can be trusted. EG: pin, etc.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">As a result of the, treat both server and user as stupid, rule, the keys must never enter the host operating system, and stay inside the enclave. Example: if a user uses an iphone, the keys must stay inside of apples secure enclave and must not enter the IOS mobile operating system. </span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Similarly, with the HSM, keys must never leave the HSM and enter the host OS. keys must stay inside the HSM at all times.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Clients must have a form of secure key deletion and rotation for perfect forward secrecy to work. Otherwise, the user will have to generate new keys manually.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Clients must not have a backdoor to access keys. Nor should there be a master key, as this compromises the security layer.</span>
      </li>
    </ul>
    <h1 class="c0" id="h.aa8c86w05d49">
      <span class="c9">Where this will not work</span>
    </h1>
    <ul class="c6 lst-kix_s57gstd1nui8-0 start">
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Metadata could be possibly leaked, EG: what websites you visit as this traffic is not protected in the session. For this to work, the VPN server itself needs to be hosted as an onion service to work correctly.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">The VPN client will obviously ask for the server. If not on a proxy or tor, the VPN server will see your host IP address.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">This will not address server based security via server compromise (E.G. a SSH key login, or a program running on the server that uses a RCE vulnerability) so the security of the server is not guaranteed. This will, however, protect the contents of your session, as this requires the client side key, which is never stored on the server.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">This does not address vulnerabilities to the secure enclave, nor does it address vulnerabilities in the HSM devices themselves. This is on the vendor to watch for.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">It is important to note this does not address malware problems, this requires common sense during browsing.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">This also does not address KYC (know your customer) exploits that relate to personally identifiable information (PII) as this has to do with no logging on the user side, not the KYC side. This protocol was not meant to address issues relating to PII or customer data like credit card numbers, real names, addresses, phone numbers, etc. this requires &nbsp;you to be vigilant about what VPN providers you trust and requires research on KYC laws.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">This will not work if the HSM used is physically stolen, and or an attacker gains access to the secure enclave itself.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">As it relates to proprietary operating systems, this does not stop Microsoft's spyware or services, this is your job to decide whether you are worried about it or not. Note: client side VPNs can be partially bypassed by system applications (E.G. apple app store, google play store, microsoft store) has access outside the VPn layer.</span>
      </li>
    </ul>
    <h1 class="c0" id="h.39w296h70iy">
      <span class="c9">The instructions (process described)</span>
    </h1>
    <p class="c1">
      <span class="c2">The user, assuming a server is configured by the administrator, inserts their key, or can choose to use the device&#39;s secure enclave.</span>
    </p>
    <p class="c1">
      <span class="c2">The first key &nbsp;for the session is generated by the client, which will be a libreSSL or a PKCS#11 library.</span>
    </p>
    <p class="c1">
      <span class="c2"><br>
      If using nitrokey HSM, a rust APi will be used for key generation on key.</span>
    </p>
    <p class="c1">
      <span class="c2">After the key is generated, the VPN client verifies that the key is generated, and if key verification is successful, the VPN will connect.</span>
    </p>
    <p class="c1">
      <span class="c2">The server will be notified of the connection, however, will not have the key.</span>
    </p>
    <h1 class="c0" id="h.3zr3l8ok3tdy">
      <span class="c9">The output </span>
    </h1>
    <p class="c1">
      <span class="c2">The VPN connects, and the connection is secure.</span>
    </p>
    <p class="c1">
      <span>The client also returns the VPN IP address, which a user can type ipconfig or a website like </span>
      <span class="c3">
        <a class="c5" href="http://whatismyip.com" target="_blank">whatismyip.com</a>
      </span>
      <span class="c2">&nbsp;to check if the IP is the same. If it matches, the VPN has successfully connected.</span>
    </p>
    <p class="c1">
      <span class="c2">After around 15minutes, every time, the key will expire, and a new one will regenerate either on the enclave or the Hsm.</span>
    </p>
    <p class="c1">
      <span class="c2">If the HSM is unavailable, the client will not fall back to the builtin device enclave, because it assumes the key is the enclave and not the device.</span>
    </p>
    <h1 class="c0" id="h.6e0g92cpr3gq">
      <span class="c9">Possible vulnerabilities</span>
    </h1>
    <ul class="c6 lst-kix_6tkr1rwl23sc-0 start">
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If the secure enclave on the device os compromised, the key, and any ephemeral keys, will be compromised as well. </span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If the computer is compromised, the key could be hijacked during generation, or overridden with the attackers key.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If the app has been redistributed on a shady site or has a signature not similar to the clientguard signature, then the app might come packed with malware. It is on the user to verify the app installation has not been compromised, and verify that the app signature matches the public sourcecode.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If the PKCS#11 library in the future has a vulnerability, this could be exploited during or after the keyy generation process to have the key be either overriden, or completely generated by the attacker, while the app may return it as successful or say it is the right key.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">If the attacker has taken control of clientguard server, the attacker will have administrative access to the CG server, meaning they could potentially turn off the VPN, or modify it to gane some access, in which they can cause more damage.</span>
      </li>
    </ul>
    <p class="c1 c4">
      <span class="c2"></span>
    </p>
    <p class="c1 c4">
      <span class="c2"></span>
    </p>
    <h1 class="c0" id="h.uqe94ij8144z">
      <span class="c9">Storage information</span>
    </h1>
    <ul class="c6 lst-kix_p0owf8905ngy-0 start">
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Some metadata, such as your username, is stored on the computer itself.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Keys, such as for authentication and encryption, are either stored on the device secure enclave, or your HSM.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">The VPN IP is stored on client</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">Logs are also stored as encrypted blobs, on both client and the server, and require the key of the session in order to access them.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">The VPN itself is handled by the operating system, so the OS will store data such as &nbsp;the name of the VPN.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">A PKCS#11 services are stored locally on the client. Note: clientguard (windows)will never use microsoft cryptographic services API because it is proprietary.</span>
      </li>
      <li class="c1 c8 li-bullet-0">
        <span class="c2">The host IP address, if not on an overlay network such as tor on router levels, will be stored both on client in error logs and server.</span>
      </li>
    </ul>
    <h1 class="c0" id="h.713njwh1y1nv">
      <span class="c9">Conclusion</span>
    </h1>
    <p class="c1">
      <span class="c2">Clientguard ames to solve the no VPN logs by using client side key generation to generate cryptographic keys to ensure that logs are not accessible to the server. It generates keys using the secure enclave of a device or TEE (E.G. android trusty, IOS secure enclave, intel TDX) or a hardware security module (E.G. nitrokey) to securely delete, generate, and rotate keys. The keys will never be stored on the device itself or on ram outside of the secure enclave or outside the key, and the server will never be able to grab this key, ensuring privacy.</span>
    </p>
    <p class="c1">
      <span class="c2">No key=no VPN logs.</span>
    </p>
    <p class="c1 c4">
      <span class="c2"></span>
    </p>
  </body>
</html>